version: 2

snapshots:
  - name: users_snapshot_timestamp
    relation: source('integrationtests', 'users')
    config:
      unique_key: user_id
      strategy: timestamp
      updated_at: ingestion_date
      dbt_valid_to_current: "to_date('9999-12-31')" 

    columns:
      - name: user_id
        description: "Unique identifier for the user."
        tests:
          - not_null

      - name: username
        description: "Lowercased and trimmed username."
        tests:
          - not_null

      - name: email
        description: "Lowercased and trimmed user email."
        tests:
          - not_null

      - name: first_name
        description: "Capitalized first name."
        tests:
          - not_null

      - name: last_name
        description: "Capitalized last name."

      - name: date_of_birth
        description: "User's date of birth."

      - name: phone_number
        description: "Trimmed phone number."

      - name: country
        description: "Country of the user."
        tests:
          - not_null
          - accepted_values:
              values: ["España"]

      - name: city
        description: "City of the user."

      - name: registration_date
        description: "Datetime when the user registered."
        tests:
          - not_null

      - name: last_login_date
        description: "Datetime when the user last logged in."

      - name: is_active
        description: "Boolean indicating whether the user is currently active."
        tests:
          - accepted_values:
              values: [true, false]

      - name: user_type
        description: "The role or plan of the user (e.g., admin, premium, standard)."
        tests:
          - accepted_values:
              values: ["admin", "premium", "standard"]

      - name: profile_picture_url
        description: "URL to the user's profile picture."

      - name: bio
        description: "Short user biography."

      - name: ingestion_date
        description: "Date when the record was ingested into the data platform."
        tests:
          - not_null

      - name: dbt_scd_id
        description: "dbt-generated hash to uniquely identify version of the row."
        tests:
          - not_null

      - name: dbt_updated_at
        description: "Timestamp when the row was updated in dbt."

      - name: dbt_valid_from
        description: "Start of validity period for this snapshot version."

      - name: dbt_valid_to
        description: "End of validity period for this snapshot version."

  - name: users_snapshot_checkcols
    relation: source('integrationtests', 'users')
    config:
      unique_key: user_id
      strategy: check
      check_cols:
        - city
        - email

    columns:
      - name: user_id
        description: "Unique identifier for the user."
        tests:
          - not_null

      - name: username
        description: "Lowercased and trimmed username."
        tests:
          - not_null

      - name: email
        description: "Lowercased and trimmed user email."
        tests:
          - not_null

      - name: first_name
        description: "Capitalized first name."
        tests:
          - not_null

      - name: last_name
        description: "Capitalized last name."

      - name: date_of_birth
        description: "User's date of birth."

      - name: phone_number
        description: "Trimmed phone number."

      - name: country
        description: "Country of the user."
        tests:
          - not_null
          - accepted_values:
              values: ["España"]

      - name: city
        description: "City of the user."

      - name: registration_date
        description: "Datetime when the user registered."
        tests:
          - not_null

      - name: last_login_date
        description: "Datetime when the user last logged in."

      - name: is_active
        description: "Boolean indicating whether the user is currently active."
        tests:
          - accepted_values:
              values: [true, false]

      - name: user_type
        description: "The role or plan of the user (e.g., admin, premium, standard)."
        tests:
          - accepted_values:
              values: ["admin", "premium", "standard"]

      - name: profile_picture_url
        description: "URL to the user's profile picture."

      - name: bio
        description: "Short user biography."

      - name: ingestion_date
        description: "Date when the record was ingested into the data platform."
        tests:
          - not_null

      - name: dbt_scd_id
        description: "dbt-generated hash to uniquely identify version of the row."
        tests:
          - not_null

      - name: dbt_updated_at
        description: "Timestamp when the row was updated in dbt."

      - name: dbt_valid_from
        description: "Start of validity period for this snapshot version."

      - name: dbt_valid_to
        description: "End of validity period for this snapshot version."